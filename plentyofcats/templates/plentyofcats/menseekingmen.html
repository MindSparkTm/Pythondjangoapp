
{% load static %}
<!doctype html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <title>Your one stop destination to get laid</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.css">
  <script

  src="https://code.jquery.com/jquery-1.12.4.js"></script>

<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/2.3.2/jspdf.plugin.autotable.js"></script>

    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
</head>

<body>

<section id="body" class="width">
    <aside id="sidebar" class="column-left">

        <header>
            <h1><a href="#">PlentyofCats</a></h1>

            <h2>Share what you want!</h2>

        </header>

        <nav id="mainnav">
            <ul>
                <li class="selected-item"><a id="postad" >Post an AD</a></li>
                <li><a id="menseekingwomen">Men seeking Women</a></li>
                <li><a id="menseekingmen">Men seeking Men</a></li>
                <li><a id="womenseekingmen">Women seeking Men</a></li>
                <li><a id="womenseekingwomen">Women seeking Women</a></li>
            </ul>
        </nav>



    </aside>
    <section id="content" class="column-right">

        <article>
            <h2>Showing ads for Kenya</h2>


                <form method="post" enctype="multipart/form-data">

                {% csrf_token %}




                     <div>
                        <label class="desc" id="title106" for="Field106">
                            Select your country
                        </label>
                        <div>
                            <select id="country" name="country" onchange="oncountrydropdownchange(this)" style="font-family: Cursive;  font-size: 20px;" class="field select medium" tabindex="11" >
                                <option value="kenya">Kenya</option>
                                <option value="uganda">Uganda</option>

                            </select>
                        </div>
                    </div>



                    <div>
                        <div>
                            <input type="submit" class="button" value="Submit Ad"></input>
                        </div>
                    </div>

                </form>


            <div>
    <table id="demotbl" class="display" cellspacing="0" width="100%">
    <thead>
        <tr>
            <th>Created</th>
            <th>Postid</th>
            <th>title</th>
            <th>More</th>









        </tr>
    </thead>
</table>

</div>
<script type="text/javascript">
     $(document).ready(function () {



   $.ajax({

       url: "/plentyofcats/getdatafromad",
            type: "get",
            data: {
               "category":"msm",
                "country":"kenya",

            },

            success: function (json) {
                console.log(json)
                if (json.length === 0) {
                    alert("No users yet")

                } else {


                    var data = jQuery.map(json, function(el, i) {
      return [[ el.created,el.postid,el.title,'More']];
    });

    $('#demotbl').DataTable( {
        "searching":false,
        "bLengthChange": false,
               "bInfo" : false,


      "aaData": data,
      "aoColumns": [
          { "sTitle": "Created" },
          {"postid":"Postid"},

          {"sTitle": "Title"},


          {
              "targets": -1,
              "data": null,
              "defaultContent": "<button id ='btn2' name='btn2'>Click for more</button>"
          }
          ]



    })
                    $('#demotbl tbody').on( 'click', 'button#btn2', function (e) {
        e.preventDefault();
        console.log('selected')
        var tr = $(this).closest('tr');
        var rows = $('#demotbl').DataTable().row(tr);

        var info = rows.data();
        var dat = [info];
        var id = info[1];


        console.log( "patientinfo",info);
        window.open("displaypost/id/"+id,'_blank');








    } );
                }
            }
   })


     })




  function oncountrydropdownchange(country){
         var table = $('#demotbl').DataTable();
         table.destroy()

         console.log('country',country.value)

          $.ajax({

       url: "/plentyofcats/getdatafromad",
            type: "get",
            data: {
               "category":"msm",
                "country":country.value,

            },

            success: function (json) {
                console.log(json)
                if (json.length === 0) {
                    alert("No users yet")

                } else {


                    var data = jQuery.map(json, function(el, i) {
      return [[ el.created,el.postid,el.title,'More']];
    });

    $('#demotbl').DataTable( {
        "searching":false,
        "bLengthChange": false,
               "bInfo" : false,


      "aaData": data,
      "aoColumns": [
          { "sTitle": "Created" },
          { "sTitle": "Postid" },


          {"sTitle": "Title"},

          {
              "targets": -1,
              "data": null,
              "defaultContent": "<button id ='btn2' name='btn2'>Click for more</button>"
          }

          ]



    })


                  }
            }
   })



         }

         $('#postad').click(function (e) {
             e.preventDefault()

             window.location.href="/plentyofcats/index"

         })

     $('#menseekingwomen').click(function (e) {
             e.preventDefault()

             window.location.href="/plentyofcats/menseekingwomen/"

         })

     $('#menseekingmen').click(function (e) {
             e.preventDefault()

             window.location.href="/plentyofcats/menseekingmen/"

         })

     $('#womenseekingmen').click(function (e) {
             e.preventDefault()

             window.location.href="/plentyofcats/womenseekingmen"

         })

     $('#womenseekingwomen').click(function (e) {
             e.preventDefault()

             window.location.href="/plentyofcats/womenseekingwomen"

         })

</script>




        </article>







        <footer class="clear">
            <p>&copy; 2018 PlentyofCats by Anonymous</p>
        </footer>

    </section>

    <div class="clear"></div>

</section>


</body>
</html>
